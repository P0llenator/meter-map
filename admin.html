<!DOCTYPE html>
<html>
<head>
  <title>Admin Map - Draw and Save</title>
  <meta charset="utf-8" />
  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
      padding: 0;
      background: #121212;
    }

    .floating-buttons {
      position: absolute;
      top: 10px;
      left: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 5;
    }

    .floating-buttons button {
      background: #1f1f1f;
      color: #fff;
      border: 1px solid #333;
      border-radius: 4px;
      padding: 8px 12px;
      font-size: 14px;
      cursor: pointer;
    }

    .floating-buttons button:hover {
      background: #333;
    }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

  <!-- Google Maps + Drawing -->
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=drawing"></script>
</head>
<body>
  <div class="floating-buttons">
    <button onclick="clearLines()">Clear All Lines</button>
  </div>
  <div id="map"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA3A66rXIFQF_Q3JyO71wTeez45cDa8JxE",
      authDomain: "mymaps-88882.firebaseapp.com",
      databaseURL: "https://mymaps-88882-default-rtdb.firebaseio.com",
      projectId: "mymaps-88882",
      storageBucket: "mymaps-88882.appspot.com",
      messagingSenderId: "1073848094921",
      appId: "1:1073848094921:web:06d32e78839996d858bd18"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let map;
    let drawingManager;
    const drawnPolylines = [];

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 31.963158, lng: 35.930359 },
        zoom: 11,
        styles: [ { elementType: 'geometry', stylers: [ { color: '#242f3e' } ] }, { elementType: 'labels.text.stroke', stylers: [ { color: '#242f3e' } ] }, { elementType: 'labels.text.fill', stylers: [ { color: '#746855' } ] }, { featureType: 'administrative.locality', elementType: 'labels.text.fill', stylers: [ { color: '#d59563' } ] }, { featureType: 'poi', elementType: 'labels.text.fill', stylers: [ { color: '#d59563' } ] }, { featureType: 'poi.park', elementType: 'geometry', stylers: [ { color: '#263c3f' } ] }, { featureType: 'poi.park', elementType: 'labels.text.fill', stylers: [ { color: '#6b9a76' } ] }, { featureType: 'road', elementType: 'geometry', stylers: [ { color: '#38414e' } ] }, { featureType: 'road', elementType: 'geometry.stroke', stylers: [ { color: '#212a37' } ] }, { featureType: 'road', elementType: 'labels.text.fill', stylers: [ { color: '#9ca5b3' } ] }, { featureType: 'road.highway', elementType: 'geometry', stylers: [ { color: '#746855' } ] }, { featureType: 'road.highway', elementType: 'geometry.stroke', stylers: [ { color: '#1f2835' } ] }, { featureType: 'road.highway', elementType: 'labels.text.fill', stylers: [ { color: '#f3d19c' } ] }, { featureType: 'transit', elementType: 'geometry', stylers: [ { color: '#2f3948' } ] }, { featureType: 'transit.station', elementType: 'labels.text.fill', stylers: [ { color: '#d59563' } ] }, { featureType: 'water', elementType: 'geometry', stylers: [ { color: '#17263c' } ] }, { featureType: 'water', elementType: 'labels.text.fill', stylers: [ { color: '#515c6d' } ] }, { featureType: 'water', elementType: 'labels.text.stroke', stylers: [ { color: '#17263c' } ] } ]
      });

      drawingManager = new google.maps.drawing.DrawingManager({
        drawingMode: google.maps.drawing.OverlayType.POLYLINE,
        drawingControl: true,
        drawingControlOptions: {
          position: google.maps.ControlPosition.TOP_CENTER,
          drawingModes: ['polyline']
        },
        polylineOptions: {
          strokeColor: "#FFD700",
          strokeOpacity: 1.0,
          strokeWeight: 4
        }
      });

      drawingManager.setMap(map);

      google.maps.event.addListener(drawingManager, 'polylinecomplete', function(polyline) {
        const path = polyline.getPath().getArray().map(p => ({ lat: p.lat(), lng: p.lng() }));
        drawnPolylines.push(polyline);
        savePolyline(path);
      });

      loadLines();
    }

    function savePolyline(path) {
      const id = Date.now();
      db.ref("lines/" + id).set({ path });
    }

    function loadLines() {
      db.ref("lines").on("value", snapshot => {
        const data = snapshot.val();
        if (!data) return;
        Object.values(data).forEach(line => {
          const polyline = new google.maps.Polyline({
            path: line.path,
            map: map,
            strokeColor: "#FFD700",
            strokeOpacity: 1.0,
            strokeWeight: 4
          });
        });
      });
    }

    function clearLines() {
      db.ref("lines").remove();
      window.location.reload();
    }

    window.onload = initMap;
  </script>
</body>
</html>
